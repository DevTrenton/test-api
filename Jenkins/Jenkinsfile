def remote = [:]
remote.name = 'devadmin'
remote.host = '192.168.100.123'
remote.allowAnyHosts = true

pipeline {
    agent any
    environment {
        DEV_CREDENTIALS = credentials('devadmin')
        GIT_CREDENTIALS = credentials('gitToken')
    }
    
    stages {
        stage('Connect to Server') {
            steps {
                script {
                    sshagent(credentials: ['devadmin']) {
                        sh "sshpass -p '${env.DEV_CREDENTIALS_PSW}' ssh -o StrictHostKeyChecking=no ${env.DEV_CREDENTIALS_USR}@${remote.host}"
                    }
                }
                echo "Connected to ${remote.host}"
            }
        }
        stage('Deploy to Server'){
            steps{
                script{
                    sshagent(credentials:['gitToken']){
                        sh "sudo docker compose up -d"
                    }
                }
            }
        }
    }
}