def remote = [:]
remote.name = 'devadmin'
remote.host = '192.168.100.123'
remote.allowAnyHosts = true

pipeline {
    agent any

    stages {
        stage('Deploying Docker Compose to Staging Server') {
            steps {
                withCredentials([sshUserPrivateKey(credentialsId: 'sshAuth', keyFileVariable: 'password', usernameVariable: 'username')]) {
                    script {
                        remote.user = env.username
                        remote.password = env.password
                        }
                    sshCommand (remote: remote, command: '''
                        cd ~/projects/deploy-nib-online/admin-portal
                        echo ${password} | sudo -S docker compose down
                        echo ${password} | sudo -S docker compose up -d
                        '''
                        )
                    }
                }
            }
        }
    }