def remote = [:]
remote.name = 'devadmin'
remote.host = '192.168.100.123'
remote.allowAnyHosts = true

pipeline {
    agent any
    environment {
        DEV_CREDENTIALS = credentials('devadmin')
        GIT_CREDENTIALS = credentials('gitToken')
    }

    stages {
        stage('Connecting to Server') {
            steps {
                script {
                    remote.user = env.DEV_CREDENTIALS_USR
                    remote.password = env.DEV_CREDENTIALS_PSW
                }
                echo "Connected to ${remote.host}"
            }
        }
        stage('Navigating to Docker Compose Directory'){
            steps{
                    dir('projects'){
                        dir('deploy-nib-online'){
                            dir('admin-portal'){
                                sshCommand(remote: remote, command: "ls -l")
                            }
                        }
                    }
            }
        }
        stage('Deploying Docker Compose'){
            steps{
                sshCommand(remote: remote, command: "sudo docker compose up -d")
            }
        }
    }
}
