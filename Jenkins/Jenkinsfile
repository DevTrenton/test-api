def remote = [:]
remote.name = 'staging'
remote.host = '192.168.100.123'
remote.allowAnyHosts = true

pipeline {
    agent any

    stages {
        stage('Deploying Docker Compose to Staging Server') {
            steps {
                withCredentials([sshUserPrivateKey(credentialsId: 'staging', keyFileVariable: 'pass', passphraseVariable: 'password', usernameVariable: 'username')]) {
                    script {
                        remote.user = env.username
                        remote.password = env.pass
                    }
                    echp "User is : ${username}"
                    echo "Pass is : ${password}"
                    sshCommand (remote: remote, command: '''
                        cd ~/projects/deploy-nib-online/admin-portal
                        echo ${SSH_KEY} | sudo -S docker compose down
                        echo ${SSH_KEY} | sudo -S docker compose up -d
                        '''
                    )
                }
            }
        }
    }
}