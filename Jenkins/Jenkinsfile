def remote = [:]
remote.name = 'staging-server'
remote.host = '192.168.100.123'
remote.allowAnyHosts = true

pipeline {
    agent any
    environment {
        DEV_CREDENTIALS = credentials('devadmin')
        GIT_CREDENTIALS = credentials('gitToken')
    }

    stages {
        stage('Deploying Docker Compose to Staging Server') {
            steps {
                script {
                    withCredentials([sshUserPrivateKey(credentialsID: 'newdevadmin', keyFileVariable: 'SSH_KEY', usernameVariable: 'SSH_USER')]) {
                        remote.user = SSH_USER,
                        remote.password = SSH_KEY
                        remote.identityfile = SSH_KEY
                }
                sshCommand (remote: remote, command: """
                    cd ~/projects/deploy-nib-online/admin-portal
                    sudo docker compose down
                    sudo docker compose up -d
                    """
                    )
                }
            }
        }
    }
}
